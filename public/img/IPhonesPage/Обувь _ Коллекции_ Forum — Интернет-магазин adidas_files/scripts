(function(c,b){function e(g){b.pushNotifications?b.pushNotifications.getUserToken(g):g(null)}function h(g,b,a){e(function(c){if(c)try{a||(a=[]),k(a)||a.push({name:"pushToken",value:c})}catch(e){}c=JSON.stringify({params:a,eventTypeKey:g,keyValue:b});d(c)})}function k(b){try{var a=!1;b.forEach(function(b){b.name&&"pushToken"===b.name&&(a=!0)});return a}catch(c){return!1}}function d(b){var a=new XMLHttpRequest;a.onerror=function(){};a.open("POST","https://esputnik.com/api/v1/event",!0);a.withCredentials=!0;
a.setRequestHeader("Authorization","Bearer eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI0NTI0ZWZhYTJkYzI2MGRmYTM4YTE1NDBlMWI1ZjE0ZWQ2YjkzZDEwMjQ0NWZhODcwNmFmNGY3MmRjOGE0ZjAyMzRhNGJkM2I0M2JhZWY2YzYxMDM3N2U2ZDgzYmRkMGIwOWNmZTUxMTU5Mzc3ZWJlYjczNDVjODMyNTFlZWEwMmQ4OWViZDNlMzI3MjY1NTZhNDdkYTI2MmViZGMxNjAyMGQ4YWUyOTY5ZjEzNjA1ZGYwMGJhZDk3OTRhYWNmIn0.ZuBr2RYZ60WrKUhmdjbgYZPKfTjSQBONu143kaR5xT7EnrX2JehPfhhOrASYV5XNajxh340mpUvAGinEin6Ngw");a.setRequestHeader("Content-Type","application/json");a.send(b)}var a=!1;c.__es_sdk?b=c.__es_sdk:(c.__es_sdk=b,b.isPushModuleOn=function(){return a});b.pushOn=function(g){b.pushNotifications&&!b.isPushModuleOn()?(a=!0,b.pushNotifications.init(g)):console.log("Push module unavailable")};b.sendEvent=function(a,b,c){h(a,b,c)};b.getPushToken=e;b.getPushContactId=function(a){b.pushNotifications?b.pushNotifications.getUserPushSubscriptionContactId(a):
a(null)};b.onWebPushSubscriptionChange=function(a){if(b.pushNotifications)b.pushNotifications.onSubscriptionChange(a,!0)}})(this,this.__es_sdk||{});
(function(F,u){function X(){if("safari"===g.userAgent.name.toLowerCase()&&L()){if("default"===window.safari.pushNotification.permission(b.main.apnWebsitePushId).permission){var a={};a.domainId=b.main.APPLICATION_ID;a.userAgent=g.userAgent.name;a.userAgentVersion=g.userAgent.version;a.userAgentLanguage=window.navigator.N||window.navigator.language;a.OS=g.platform;a.subscriptionPage=window.location.href;window.safari.pushNotification.requestPermission(b.main.apnSubscriptionServiceUrl,b.main.apnWebsitePushId,
a,ma);r.close()}try{document.body.removeEventListener("click",X)}catch(d){}}}function t(){try{!g.b||g.b&&b.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?na():g.b&&!b.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?M.j():c.error("[registerController()] NO ACTIONS !!!")}catch(a){c.log("[registerController()] handle error ",a)}}function L(){return"safari"in window&&"pushNotification"in window.safari}function w(){return L()?window.safari.pushNotification.permission(b.main.apnWebsitePushId):
window.Notification}function Y(a){c.log("[init()] Started process...");var d=b.urls,f=Z;a&&a["service-worker"]&&a["service-worker"].relUrl?f=a:c.log("Custom service worker script url is not provided, use default");d.SERVICE_WORKER_URL_HTTPS=f["service-worker"].relUrl;d=b.subscription;f=Z;a&&a["service-worker"]&&a["service-worker"].scope||(c.log("Custom service worker scope is not provided, use default"),a=f);d.serviceWorkerScope=a["service-worker"].scope;c.log("Configuration: ");c.log("Target Domain: ",
b.main.targetDomain);c.log("Proxy Domain: ",b.main.proxyDomain);c.log("Application ID: ",b.main.APPLICATION_ID);c.log("Notifications Service: ",b.main.notificationsService);c.log("Apple Push Notification Website Push ID: ",b.main.apnWebsitePushId);c.log("Show Subscription IFrame Result [s]: ",b.subscription.timeSuccessShow);c.log("Timeout on ignore prompt: ",b.subscription.timeoutIgnorePopover);c.log("Timeout on block prompt: ",b.subscription.timeBlockPopover);c.log("Validation period: ",b.validation.validationPeriod);
c.log("Is Validation Enabled: ",b.validation.isValidationEnabled);c.log("Validation Window Width: ",b.validation.validationWindowWidth);c.log("Validation Window Height: ",b.validation.validationWindowHeight);c.log("Token Data Update Period: ",b.updates.tokenDataUpdatePeriod);c.log("Is show special for Https: ",b.main.IS_SHOW_SPECIAL_FOR_HTTPS);c.log("Use client proxy for special Https: ",b.main.USE_CLIENT_PROXY_FOR_SPECIAL_HTTPS);c.log("App Manifest URL: ",b.urls.APP_MANIFEST_URL_HTTPS);c.log("Service Worker URL: ",
b.urls.SERVICE_WORKER_URL_HTTPS);c.log("Show IFrame for Https: ",b.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS);c.log("Show Prompt Delay: ",b.subscription.SHOW_PROMPT_DELAY);c.log("Is logger enabled: ",b.logging.IS_LOGGER_ENABLED);g.platform=z.B();g.userAgent=z.F();g.b=z.b();g.isSupported=z.K();g.i=z.J();c.log("[init()] Environment: ",g);c.log("");oa()}function N(){"serviceWorker"in navigator&&navigator.serviceWorker.register(b.urls.SERVICE_WORKER_URL_HTTPS,{scope:b.subscription.serviceWorkerScope}).then(function(a){c.log("[registerServiceWorker()] sw registered for scope: ",
a.scope);c.log("[registerServiceWorker()] OK:",a);c.log("");pa()})["catch"](function(a){c.error("[registerServiceWorker()] FAIL:",a)});try{document.body.removeEventListener("click",N)}catch(a){}}function ma(a){if("denied"===a.permission)c.log("User refused push notifications"),"true"===b.subscription.FLOATING_BUTTON_ENABLED&&("true"!==b.subscription.FLOATING_BUTTON_REMINDER_ENABLED||"true"===b.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&0===1E3*b.subscription.FLOATING_BUTTON_REMINDER_DELAY)&&r.c();
else if("granted"===a.permission){c.log("User allow push notifications");var d={};d.token=a.deviceToken;A.l(d)}}function pa(){c.log("[checkSubscriptionInGCM()] Started.. ");navigator.serviceWorker.ready.then(function(a){try{a.pushManager.getSubscription().then(function(d){c.log("[checkSubscriptionInGCM()] OK, subscription =",d);if(d){var f=O(d),e={};e.token=f;e.auth=G(d.getKey("auth"));e.p256dh=G(d.getKey("p256dh"));A.l(e)}else qa(a)})["catch"](function(a){c.error("[checkSubscriptionInGCM()] FAIL: ",
a)})}catch(d){}})}function qa(a){var d={userVisibleOnly:!0};H()&&(d.applicationServerKey=ra(b.subscription.vapidApplicationServerKey));a.pushManager.subscribe(d).then(function(a){var d=O(a),c={};c.token=d;c.auth=G(a.getKey("auth"));c.p256dh=G(a.getKey("p256dh"));A.l(c)})["catch"](function(a){"true"===b.subscription.FLOATING_BUTTON_ENABLED&&("true"!==b.subscription.FLOATING_BUTTON_REMINDER_ENABLED||"true"===b.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&0===1E3*b.subscription.FLOATING_BUTTON_REMINDER_DELAY)&&
r.c();c.warn("[subscribe()] FAIL: ",a)})}function H(){var a=b.subscription.vapidApplicationServerKey;return a&&0!==a.length}function ra(a){var d="=".repeat((4-a.length%4)%4);a=(a+d).replace(/\-/g,"+").replace(/_/g,"/");a=window.atob(a);for(var d=new Uint8Array(a.length),c=0;c<a.length;++c)d[c]=a.charCodeAt(c);return d}function G(a){return btoa(String.fromCharCode.apply(null,new Uint8Array(a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function O(a){c.log("[parseSubscriptionEndpoint()] Started... ");
a=a.subscriptionId?a.subscriptionId:a.endpoint;c.log("[parseSubscriptionEndpoint()] OK, subscriptionEndpoint = ",a);return a}function oa(){k.get("Contacts",function(a){a.target.result&&a.target.result.value&&I(a.target.result.value)})}function I(a){"localStorage"in window&&void 0!==a&&null!==a&&localStorage.setItem("esWebPushContactId",a)}function P(){for(var a=0;a<aa.length;a++){var d;a:{var c=document.getElementById(aa[a]);if(c)try{d=c.innerHTML.trim();break a}catch(e){}d=null}if(d&&/^\S+@\S+$/.test(d))return d}return null}
function ba(a,d){k.get("cmms",function(c){c.target.result?d(a,c.target.result.value):d(a,null)},function(){d(a,null)})}function ca(a,d){var f=P();f&&A.m(a,"5",f,d,function(a,d){try{if(a&&d&&(d=JSON.parse(d),d.cmms&&k.a({key:"cmms",value:d.cmms}),1==d.type)){var f=d.value;k.a({key:"Contacts",value:d.value},function(){I(f)})}}catch(b){c.error("[bind()] ",b)}})}function sa(a){a=a.scriptURL;a=0==a.indexOf(window.location.origin)?a.substring(window.location.origin.length):void 0;return a&&-1!=a.indexOf(b.urls.SERVICE_WORKER_URL_HTTPS)}
function ta(){k.remove("SID",function(){try{g.b&&!b.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?da()["catch"](function(a){c.log("error unsubscribing",a)}).then(function(){t()}):t()}catch(a){}},function(a){c.log("Failed to remove subscription info from storage: "+a.target.errorCode)})}function da(){return navigator.serviceWorker.ready.then(function(a){try{return a.pushManager.getSubscription().then(function(a){if(a)return a.unsubscribe()})["catch"](function(){})}catch(d){return Promise.reject(d)}})}
function ea(a){var d=null;c.log("[init()] check utm labels:",window.location.search);window.location.search.replace(/^\?/,"").split("&").forEach(function(e){e=e.split("=");a==e[0]&&(c.log("[init()] contactId from url =",e[1]),0===e[1]%1&&(d=e[1]))});var f;try{f=!isNaN(d-parseInt(d))}catch(e){f=!1}return f?d:null}function na(){c.log("[showCustomPopOverDialogController()] Starting...");v.I(k,fa);try{ua(function(a,d){a&&va(function(a){var e=w();try{a&&e&&"granted"===e.permission||Q(function(a){try{if(a){var f=
new Date(d),p=new Date;"true"===b.subscription.FLOATING_BUTTON_REMINDER_ENABLED?x(f,p)>1E3*b.subscription.FLOATING_BUTTON_REMINDER_DELAY&&r.c():x(f,p)>864E5*b.subscription.timeBlockPopover&&v.f()}else{var m=new Date;"true"===b.subscription.FLOATING_BUTTON_ENABLED&&"true"===b.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&e&&"denied"===e.permission?r.c():(!d||x(d,m)>1E3*b.subscription.timeoutIgnorePopover)&&e&&"denied"!==e.permission&&v.f()}}catch(wa){c.error("check before iframe",wa)}})}catch(h){c.error("check before iframe",
h)}})})}catch(a){c.error("check before iframe",a)}}function ua(a){k.get("userPrompted",function(d){var f=null;void 0===d.target.result?c.log("New visitor, try to subscribe ..."):void 0!==d.target.result.value&&(f=new Date(d.target.result.value.date));a(!0,f)},function(){a(!1,null)})}function Q(a){k.get("refused",function(d){a(d.target.result)},function(d){c.log("Failed to retrieve refused key, error: "+d.target.errorCode);a(null)})}function va(a){k.get("SID",function(d){a(d.target.result)},function(d){c.log("Failed to retrieve ID key, error: "+
d.target.errorCode);a(null)})}function fa(){try{c.log("Subscription denied"),k.a({key:"refused",value:(new Date).toString()})}catch(a){}}function x(a,d){return d.getTime()-a.getTime()}function ga(){var a=window.location.protocol;return b.main.IS_SHOW_SPECIAL_FOR_HTTPS&&"https:"===a?!0:!1}function ha(a,d,c){var e=new Date;e.setTime(e.getTime()+864E5*c);document.cookie=a+"="+d+"; path=/;"+("expires="+e.toUTCString())}function R(a){function d(d,e,b){c.log("[sendResultCallback()] save to indexedDb..");
c.log("[sendResultCallback()]",d,e,b);try{if(d&&b){c.log("[sendResultCallback()] Starting save token to indexedDb:",b.token);var l={sid:b.token,bnd:e};H()&&a.auth&&(l.auth=a.auth);H()&&a.p256dh&&(l.p256dh=a.p256dh);k.a({key:"SID",value:l});k.a({key:"activeness.check",value:(new Date).getTime()});b.cmms&&k.a({key:"cmms",value:b.cmms});b.bindings?(c.log("[sendResultCallback()] Starting save to indexedDb:",b.bindings),b.bindings.forEach(function(a){if(1==a.type){var d=a.value;k.a({key:"Contacts",value:a.value},
function(){I(d)});try{b.status&&"NEW"===b.status&&J.rememberEvent({type:"subscription-change",data:{type:"new-subscription",token:b.token,contactId:a.value}})}catch(e){c.error("[evt error()]",e)}}else 2==a.type?ha("es-bind-id",a.value,1095):3==a.type&&k.a({key:"sw-md5",value:{hash:a.value,date:(new Date).toString()}})})):c.warn("[sendResultCallback()] return, data.bindings = ",b.bindings)}else c.warn("[sendResultCallback()] return, subscription not saved")}catch(p){c.error("[syncSubscription()]",
p)}}c.log("[syncSubscription()]",a);k.get("SID",function(b){try{if(!b.target.result)ia(a,d);else if(b.target.result.value!==a.token){var e=b.target.result.value;c.warn("[[syncSubscription()]] old data in indexedDB",e,a);ja(e,a,d)}}catch(h){c.error("[syncSubscription()]",h)}},function(){c.error("Failed to get SID data")})}function ia(a,d){c.log("[sendSubscriptionToService()]",a);try{var f=new XMLHttpRequest;f.onreadystatechange=function(){try{4==f.readyState&&(200==f.status?d(!0,!0,JSON.parse(f.responseText)):
409==f.status?d(!0,!0,JSON.parse(f.responseText)):(c.warn("Bad Response status = ",f),d(!1,!1,null)))}catch(a){c.error("[sendSubscriptionToService()]",a)}};f.open("PUT",b.main.notificationsService+"/v1/subscribe/",!0);f.setRequestHeader("Content-Type","application/json");var e={};e.domainId=b.main.APPLICATION_ID;e.endpoint=a.token;H()&&(a.auth&&a.p256dh&&(e.keys={},e.keys.auth=a.auth,e.keys.p256dh=a.p256dh),e.subscriptionType="VAPID");e.userAgent=g.userAgent.name;e.userAgentVersion=g.userAgent.version;
e.userAgentLanguage=window.navigator.N||window.navigator.language;e.userLanguage=S.g();e.OS=g.platform;e.subscriptionPage=window.location.href;e.binding=xa();f.send(JSON.stringify(e))}catch(h){c.error("[sendSubscriptionToService()]",h)}}function ya(a,d){try{var f=new XMLHttpRequest;f.onreadystatechange=function(){try{var a=!0;4==f.readyState&&(410==f.status&&(a=!1),k.a({key:"activeness.check",value:(new Date).getTime()},function(){d(a)}))}catch(b){c.error("[checkSubscriptionIsActive()]",b)}};f.open("GET",
b.main.notificationsService+"/v1/wps/"+b.main.APPLICATION_ID+"/subscription/state?sid="+encodeURIComponent(a),!0);f.setRequestHeader("Content-Type","application/json");f.send()}catch(e){d(!0)}}function xa(){var a={},d;if(n&&0!==n.length)d=n;else a:{if("localStorage"in window&&(d=localStorage.getItem("esWebPushContactId",d),void 0!==d&&null!==d))break a;d=null}d&&""!=d?(a.type="1",a.value=d):P()?(a.type="5",a.value=P()):""!=K&&(a.type="2",a.value=K);return a}function ja(a,d,b){c.log("Send updated subscription to server:"+
d);c.log("Old subscription:"+a);b(!0,null)}function ka(a,d){k.get(a,function(a){try{var c=a.target.result;a=null;c&&(a=new Date(c.value));d(a)}catch(b){d(null)}})}function za(a){ka("validation",function(d){if(null!=d&&x(d,new Date)<b.validation.validationPeriod)return a(!1);a(!0)})}function Aa(a){ka("activeness.check",function(d){if(null!=d){try{var c=parseInt(d);Number.isNaN(c)||(d=c)}catch(b){}if(259200000>x(d,new Date)){a(!1);return}}a(!0)})}function Ba(a,d,
f){try{za(function(e){if(e){var h=new XMLHttpRequest;h.onreadystatechange=function(){try{4==h.readyState&&200==h.status&&(T="true"===h.responseText?!0:!1,c.log("Is token valid: "+T),T?f():Ca(a,d),k.a({key:"validation",value:(new Date).toString()}))}catch(b){c.log("Failed to update service worker: "+b)}};null!=a&&(h.open("GET",b.main.notificationsService+"/v1/subscription/validate?value="+a+"&app="+b.main.APPLICATION_ID,!0),h.setRequestHeader("Content-Type","application/json"),h.send())}else f()})}catch(e){c.log("Error: "+
e)}}function Ca(a,d){var f=new XMLHttpRequest;f.onreadystatechange=function(){try{4==f.readyState&&200==f.status&&(c.log("Token is set to inactive"),k.remove("SID",function(){c.log("SID key is removed from storage");d()},function(a){c.log("Failed to remove subscription info from storage: "+a.target.errorCode)}))}catch(a){c.log("Failed to deactivate token: "+a)}};f.open("PUT",b.main.notificationsService+"/v1/subscription/"+a+"/inactive",!0);f.setRequestHeader("Content-Type","application/json");f.send()}
function y(a,d,c){if(!a||!c)return d;var b;try{b="string"===typeof a?JSON.parse(a):a;if(!Array.isArray(b)||!b.length)return d;var h=b.find(function(a){return a.lang===c}),l=b.find(function(a){return a.origin});return h?h.text||d:l?l.text:d}catch(p){return d}}F.__es_sdk||(F.__es_sdk={});F.__es_sdk.pushNotifications=u;var Z={manifest:{included:!1,relUrl:"/manifest.json"},"service-worker":{relUrl:"/sw.js",scope:"/"}},b={main:{targetDomain:"https://www.adidas.ua",proxyDomain:"",APPLICATION_ID:"40444FD9-2C00-4727-8AED-CDFFF94A1529",
notificationsService:"https://push.esputnik.com",apnWebsitePushId:"",apnSubscriptionServiceUrl:"https://push.esputnik.com/v1/subscribe/apns/safari",isApnEnabled:false,IS_SHOW_SPECIAL_FOR_HTTPS:true,USE_CLIENT_PROXY_FOR_SPECIAL_HTTPS:false,IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS:!1},subscription:{timeSuccessShow:8,timeoutIgnorePopover:0,timeBlockPopover:7,SHOW_PROMPT_DELAY:9,
promptMode:1,subscriptionPromptAcceptBtnText:"Разрешить",subscriptionPromptAcceptBtnTextArr:[{"origin":true,"text":"Разрешить"}],subscriptionPromptAcceptBtnTextArr123:[{"origin":true,"text":"Разрешить"}],subscriptionPromptDeclineBtnText:"Запретить",subscriptionPromptDeclineBtnTextArr:[{"origin":true,"text":"Запретить"}],subscriptionPromptText:"Кликните &quot;Разрешить&quot;, чтобы получать уведомления от https://www.adidas.ua/",subscriptionPromptTextArr:[{"origin":true,"text":"Кликните \u0026quot;Разрешить\u0026quot;, чтобы получать уведомления от https://www.adidas.ua/"}],
subscriptionPopoverType:1,vapidApplicationServerKey:"BF65Z6vKEaFl6GNv9RVL0q4UjY6mPGE77lBVntE-fseSi1z-32fZx-kQ-OuvWYaHyWedyeXdLSEhG5Elkx94lXo",serviceWorkerScope:"/",FLOATING_BUTTON_ENABLED:"false",FLOATING_BUTTON_BACKGROUND_COLOR:"#3A9EDA",FLOATING_BUTTON_SIDE:"left",FLOATING_BUTTON_BOTTOM_DIMENSION:"20px",FLOATING_BUTTON_SIDE_DIMENSION:"20px",FLOATING_BUTTON_ANIMATION_TYPE:"vibrate",
FLOATING_BUTTON_REMINDER_ENABLED:"false",FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT:"Кликните, чтобы включить уведомления",FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT_ARR:[{"origin":true,"text":"Кликните, чтобы включить уведомления"}],FLOATING_BUTTON_REMINDER_BLOCKED_TEXT:"Чтобы включить уведомления, выполните следующие действия:",FLOATING_BUTTON_REMINDER_BLOCKED_TEXT_ARR:[{"origin":true,"text":"Чтобы включить уведомления, выполните следующие действия:"}],FLOATING_BUTTON_REMINDER_DELAY:"604800"},validation:{validationPeriod:86400000,
isValidationEnabled:false,validationWindowWidth:500,validationWindowHeight:300},updates:{tokenDataUpdatePeriod:604800000},urls:{SERVICE_WORKER_URL_HTTPS:"/sw.js"},logging:{IS_LOGGER_ENABLED:false}},aa=["EsputnikEmail","esputnikemail","esputnikEmail","eSputnikEmail","Esputnikemail"],n="",K="",T=!1,J={};(function(a){var d={},b={};a.rememberEvent=function(a){try{if(b[a.type]||(b[a.type]=
[]),b[a.type].push(a),d[a.type])for(var h=0;h<d[a.type].length;h++)if(d[a.type][h])try{d[a.type][h](a)}catch(l){c.log("failed to fire evt",l)}}catch(l){c.log("Failed to remember event",l)}};a.registerListener=function(a,c,l){d[a]||(d[a]=[]);if(l&&(l=b[a]))for(var p=0;p<l.length;p++)c(l[p]);d[a].push(c)}})(J);var Da={onPageLoad:1,byElementClick:2},U={"default":1,topPanel:2,bottomPanel:3},g={platform:null,userAgent:null,isSupported:!1,b:!1,i:!1},M={U:t,j:function(){c.log("[registerServiceWorker()] Started...");
L()?document.body.addEventListener("click",X):-1<navigator.userAgent.toLowerCase().indexOf("firefox")?document.body.addEventListener("click",N):N()}},Fa={bind:function(){c.log("[bind()] Starting...");n=ea("utm_content");K=Ea.A("es-bind-id");c.log("[bind()] userId =",n);c.log("[bind()] uuid =",K);k.get("SID",function(a){function d(a){a&&""!==a&&ya(a,function(a){a?l():ta()})}function f(){var b=a.target.result.value.sid;"serviceWorker"in navigator&&ga()?navigator.serviceWorker.getRegistration().then(function(a){a&&
a.active&&sa(a.active)&&a.pushManager.getSubscription().then(function(a){a&&(a=O(a))&&-1!=a.indexOf(b)&&d(b)})["catch"](function(){})})["catch"](function(){}):d(b)}function e(d){var b=a.target.result.value.sid;A.m(b,"1",n,null,function(a,e){try{if(a&&e){e=JSON.parse(e);var f=e.value;1==e.type&&k.a({key:"Contacts",value:e.value},function(){I(f);try{J.rememberEvent({type:"subscription-change",data:{type:"contact-id-update",token:b,contactId:d,newContactId:e.value}})}catch(a){c.error("[evt error()] ",
a)}})}}catch(h){c.error("[bind()] ",h)}})}function h(){if(a.target.result.value){var d=a.target.result.value.sid;k.get("Contacts",function(a){try{if(a.target.result){var b=a.target.result.value;n&&""!==n&&n!=b?e(b):ba(d,ca)}else n&&""!==n?e(null):ba(d,ca)}catch(f){c.log("[bind()] ",f)}})}}function l(){var d=a.target.result.value.sid;b.validation.isValidationEnabled&&!g.b?Ba(d,t,h):h()}c.log("[bind()] Starting...");c.log("[bind()]  Check SID in DB: ",a.target.result);try{window.localStorage.setItem("es_webpush_inited",
"1")}catch(m){}var p=w();a.target.result?("true"===b.subscription.FLOATING_BUTTON_ENABLED&&"true"===b.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&p&&"granted"!==p.permission&&(p&&"denied"===p.permission&&Q(function(a){a||fa()}),t()),Aa(function(a){a?f():l()})):(c.log("[bind()] No SID in DB, try to register"),b.subscription.FLOATING_BUTTON_ENABLED&&p&&"granted"===p.permission?M.j():g.b&&!b.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?navigator.serviceWorker.getRegistrations().then(function(a){a&&
0<a.length?da().then(function(){t()}):t()})["catch"](function(){}):t())},function(){c.log("Failed to get data")});c.log("[bind()] Finish");c.log("")}},Ea={A:function(a){var d="";a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var h=b[c];" "==h.charAt(0);)h=h.substring(1);0==h.indexOf(a)&&(d=h.substring(a.length,h.length))}return d},Y:ha,R:function(){document.cookie=name+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}},A={W:ia,m:function(a,d,f,e,h){c.log("[sendBindRequestToService()] Starting...");
try{var l=new XMLHttpRequest;l.onreadystatechange=function(){try{4===l.readyState&&(200==l.status?h(!0,l.responseText):h(!1,null))}catch(a){c.error("[sendBindRequestToService()]",a)}};l.open("PUT",b.main.notificationsService+"/v1/bind/",!0);l.setRequestHeader("Content-Type","application/json");l.send(JSON.stringify({token:a,type:d,value:f,appId:b.main.APPLICATION_ID,cmms:e}))}catch(p){c.error("[sendBindRequestToService()]",p)}},X:ja,l:R,V:function(){c.log("Try Register User Visit");k.get("SID",function(a){c.log("Check SID in DB: ",
a.target.result);a.target.result?(c.log("Register User Visit"),a=a.target.result.value.sid,F.__es_sdk.S("user_visited_site",a,[{name:"sid",value:a}])):c.log("No SID in DB")})}},c={log:function(){console&&c.isEnabled()&&console.log.apply(console,arguments)},warn:function(){console&&c.isEnabled()&&console.warn.apply(console,arguments)},error:function(){console&&c.isEnabled()&&console.error.apply(console,arguments)},isEnabled:function(){return/true/.test(b.logging.IS_LOGGER_ENABLED)}},z={T:Y,F:function(){var a,
d=navigator.userAgent,b=d.match(/(opera|chrome|safari|firefox|msie|yabrowser|trident(?=\/))\/?\s*(\d+)/i)||[],c=d.match(/(edge?(?=\/))\/?\s*(\d+)/i)||[];if("Edge"===c[1]||-1!=d.indexOf("Edg"))return{name:c[1],version:c[2]};if(/trident/i.test(b[1]))return a=/\brv[ :]+(\d+)/g.exec(d)||[],{name:"IE",version:a[1]||""};if("Chrome"===b[1]){a=d.match(/\bOPR\/(\d+)/);if(null!=a)return{name:"Opera",version:a[1]};if(a=d.match(/\bYaBrowser\/(\d+)/),null!=a)return{name:"Yandex",version:a[1]}}return b=b[2]?[b[1],
b[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=d.match(/version\/(\d+)/i))&&b.splice(1,1,a[1]),{name:b[0],version:b[1]}},B:function(){var a="Windows FreeBSD Android iPhone Linux Mac".split(" ");for(i=0;i<a.length;i++)if(-1!=navigator.userAgent.indexOf(a[i]))return a[i];return""},b:ga,K:function(){if("iPhone"===g.platform||""===g.platform)return!1;if("chrome"===g.userAgent.name.toLowerCase()&&42<=parseFloat(g.userAgent.version)||"firefox"===g.userAgent.name.toLowerCase()&&44<=parseFloat(g.userAgent.version))return!0;
if("safari"===g.userAgent.name.toLowerCase())return b.main.isApnEnabled&&10<=g.userAgent.version;if("opera"===g.userAgent.name.toLowerCase()&&43<=parseFloat(g.userAgent.version)||"yandex"===g.userAgent.name.toLowerCase()&&18<=parseFloat(g.userAgent.version))return!0},J:function(){var a=(b.main.targetDomain||"").replace("://www.","://");return 0===window.location.href.replace("://www.","://").indexOf(a)}},la={h:Y,w:function(){c.log("[checkData()] Started..");g.isSupported||c.warn("[checkData()] FAIL, Environment is not supported:",
g);g.i||c.warn("[checkData()] FAIL,this  is not target domain",g);c.log("[checkData()] Ok");c.log("")},O:ea};u.init=function(a){try{var d=function(){try{la.h(a),la.w(),g.isSupported&&g.i&&Fa.bind()}catch(b){c.log("[main()] handle error ",b)}};b.subscription.promptMode===Da.onPageLoad?setTimeout(d,1E3*b.subscription.SHOW_PROMPT_DELAY):document.addEventListener("click",function(a){a.target.closest(".es-push-prompt-init")&&(c.log("init subscription by click"),d())},!1)}catch(f){c.log("[init] handle error ",
f)}};u.getUserToken=function(a){k.get("SID",function(b){var c=null;b.target.result&&(c=b.target.result.value.sid);a(c)})};u.getUserPushSubscriptionContactId=function(a){k.get("Contacts",function(b){var c=null;b.target.result&&(c=b.target.result.value);try{c=parseInt(c),isNaN(c)&&(c=null)}catch(e){c=null}a(c)})};u.onSubscriptionChange=function(a,b){J.registerListener("subscription-change",a,b)};var k=function(){function a(a,b){try{var d=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||
window.msIndexedDB).open("es-push-integration",1);d.onsuccess=function(b){try{f=b.target.result,a()}catch(c){}};d.onerror=function(a){try{c.log("DB opening error: "+a.target.errorCode),b()}catch(d){}};d.onupgradeneeded=function(a){try{a.target.result.createObjectStore("integration-data",{keyPath:"key"})}catch(b){}}}catch(p){}}function b(d){try{f?d():a(function(){d()},function(){c.log("DB init failed")})}catch(h){c.log("Error occurred: "+h)}}var f=null;return{a:function(a,c,l){b(function(){var b=f.transaction(["integration-data"],
"readwrite").objectStore("integration-data").put(a);b.onsuccess=c;b.onerror=l})},remove:function(a,c,l){b(function(){var b=f.transaction(["integration-data"],"readwrite").objectStore("integration-data")["delete"](a);b.onsuccess=c;b.onerror=l})},get:function(a,c,l){b(function(){var b=f.transaction(["integration-data"],"readonly").objectStore("integration-data").get(a);b.onsuccess=c;b.onerror=l})}}}(),r=function(){function a(a,c){function d(){e.querySelector(".js-webPushSubscriptionBlockedTip").style.display=
"none"}var m=document.createElement("div"),g=S.g(),k="color: "+b.subscription.FLOATING_BUTTON_BACKGROUND_COLOR+"; background-color: "+b.subscription.FLOATING_BUTTON_BACKGROUND_COLOR+"; display: none;",q="bottom: "+b.subscription.FLOATING_BUTTON_BOTTOM_DIMENSION+";\n                                z-index: 2147483647; \n                                "+b.subscription.FLOATING_BUTTON_SIDE+": "+b.subscription.FLOATING_BUTTON_SIDE_DIMENSION+";";try{m.classList.add("webPushSubscriptionPreview--component"),
m.classList.add("widget-icon-"+b.subscription.FLOATING_BUTTON_SIDE),m.setAttribute("style",q),m.innerHTML='\n                    <div class="js-webPushSubscriptionPreview webPushSubscriptionPreview" style="display: none;">\n                        <div class="webPushSubscriptionPreview--inner">\n                            <span class="webPushSubscriptionPreview--text">\n                                '+y(b.subscription.subscriptionPromptTextArr,b.subscription.subscriptionPromptText,g)+'\n                            </span>\n                            <div class="webPushSubscriptionPreview--confirm">\n                                <button id="es-push-decline-btn" class="webPushSubscriptionPreview--button webPushSubscriptionPreview--button__decline">\n                                    '+
y(b.subscription.subscriptionPromptDeclineBtnTextArr,b.subscription.subscriptionPromptDeclineBtnText,g)+'\n                                 </button>\n                                 <button id="es-push-accept-btn" class="webPushSubscriptionPreview--button webPushSubscriptionPreview--button__accept">\n                                    '+y(b.subscription.subscriptionPromptAcceptBtnTextArr,b.subscription.subscriptionPromptAcceptBtnText,g)+'\n                                 </button>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="js-webPushSubscriptionAlert webPushSubscriptionPreview--widgetTooltip webPushSubscriptionPreview--widgetTooltip__notBlocked" style="display: none;">\n                        '+
y(b.subscription.FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT_ARR,b.subscription.FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT,g)+'\n                    </div>\n                    <div class="js-webPushSubscriptionBlockedAlert webPushSubscriptionPreview--widgetTooltip webPushSubscriptionPreview--widgetTooltip__blocked" style="display: none;">\n                        '+y(b.subscription.FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT_ARR,b.subscription.FLOATING_BUTTON_REMINDER_NOT_BLOCKED_TEXT,g)+'\n                    </div>\n                    <div class="js-webPushSubscriptionBlockedTip webPushSubscriptionPreview--widgetTooltip" style="display: none;">\n                        <div class="widgetTooltip--text">\n                            <span>\n                            '+
y(b.subscription.FLOATING_BUTTON_REMINDER_BLOCKED_TEXT_ARR,b.subscription.FLOATING_BUTTON_REMINDER_BLOCKED_TEXT,g)+'\n                            </span>\n                            <span class="widgetTooltip--close close-prompt"></span>\n                        </div>\n                        <div class="widgetTooltip--imageContainer">\n                            <img class="widgetTooltip--image" src="https://statics.esputnik.com/images/widgetTooltip.png"/>\n                        </div>\n                    </div>\n                    <div class="js-bell-widget-icon widget-icon-wrap '+
b.subscription.FLOATING_BUTTON_ANIMATION_TYPE+'" style="'+k+'">\n                        <img alt="widget icon" src="'+b.main.notificationsService+"/push/resource/"+b.main.APPLICATION_ID+"/floating_button?decache="+(new Date).getTime()+'">\n                    </div>\n                ',m.style.visibility="hidden",m.querySelector(".widgetTooltip--close").addEventListener("click",d),m.querySelector("#es-push-decline-btn").addEventListener("click",function(){f();"true"===b.subscription.FLOATING_BUTTON_REMINDER_ENABLED&&
0===1*b.subscription.FLOATING_BUTTON_REMINDER_DELAY&&r.c();c()}),m.querySelector("#es-push-accept-btn").addEventListener("click",function(){f();a()}),m.querySelector(".js-bell-widget-icon").addEventListener("click",function(){Q(function(a){var c=w();try{c&&"default"===c.permission&&(a?x(new Date(a&&a.value),new Date)>1E3*b.subscription.FLOATING_BUTTON_REMINDER_DELAY&&(v.f(),m.querySelector(".js-webPushSubscriptionAlert").style.display="none"):(v.f(),m.querySelector(".js-webPushSubscriptionAlert").style.display=
"none"))}catch(d){}})})}catch(Ga){}return m}function d(a,d){S.g();try{var e="push-notification-popover",g="push-notification-prompt-buttons";b.subscription.subscriptionPopoverType===U.topPanel?(e="push-notification-popover-top",g="push-notification-prompt-inline-buttons"):b.subscription.subscriptionPopoverType===U.bottomPanel&&(e="push-notification-popover-bottom",g="push-notification-prompt-inline-buttons");var k=document.createElement("div");k.setAttribute("class","push-notification-prompt "+e);
var B=document.createElement("div");B.setAttribute("class","push-notification-prompt-message");var q=document.createElement("div"),n=document.createElement("img");n.setAttribute("class","push-notification-bell-icon");n.setAttribute("width","14");n.setAttribute("height","14");n.setAttribute("src",b.main.notificationsService+"/img/subscription-notify-icon.svg");q.appendChild(n);q.setAttribute("class","push-notification-prompt-message-text");var C=document.createElement("div");C.setAttribute("class",
g);var D=document.createElement("button");D.setAttribute("class","push-notification-prompt-btn push-notification-accept-btn");D.setAttribute("type","button");D.onclick=a;D.innerHTML=b.subscription.subscriptionPromptAcceptBtnText;var E=document.createElement("button");E.setAttribute("class","push-notification-prompt-btn push-notification-disallow-btn");E.setAttribute("type","button");E.onclick=function(){f();d()};E.innerHTML=b.subscription.subscriptionPromptDeclineBtnText;C.appendChild(E);C.appendChild(D);
B.appendChild(q);if(b.subscription.subscriptionPopoverType===U["default"]){B.appendChild(C);var V=document.createElement("div");V.setAttribute("class","push-prompt-text");V.innerHTML=b.subscription.subscriptionPromptText;q.appendChild(V)}else q.innerHTML+=b.subscription.subscriptionPromptText,q.appendChild(C);k.appendChild(B);var W=document.createElement("span");W.setAttribute("class","close-prompt");W.onclick=function(){f()};B.appendChild(W);k.style.visibility="hidden";return k}catch(r){return c.error("prompt ctor error: ",
r),null}}function f(){try{null!=e&&(e.style.visibility="hidden",e.classList.contains("webPushSubscriptionPreview--component")&&Array.from(e.children).forEach(function(a){a.style.display="none"}))}catch(a){c.error("prompt widget error:",a)}}var e=null;return{h:function(c,f){var g=document.getElementsByTagName("head")[0],m=document.createElement("link");m.rel="stylesheet";m.type="text/css";m.href=b.main.notificationsService+"/resource/"+b.main.APPLICATION_ID+"/es-subscription-prompt-style.css";g.appendChild(m);
e="true"===b.subscription.FLOATING_BUTTON_ENABLED?a(c,f):d(c,f);null!=e&&document.body.appendChild(e)},show:function(){try{null!=e&&(e.style.visibility="visible",e.classList.contains("webPushSubscriptionPreview--component")&&Array.from(e.children).forEach(function(a){a.classList.contains("js-webPushSubscriptionPreview")&&(a.style.display="block");a.classList.contains("js-bell-widget-icon")&&(a.style.display="flex")}))}catch(a){c.error("prompt widget error:",a)}},close:f,L:function(){},M:function(){},
c:function(){try{if(null!=e){e.style.visibility="visible";var a=e.querySelector(".js-webPushSubscriptionBlockedTip"),b=e.querySelector(".js-webPushSubscriptionAlert"),d=e.querySelector(".js-webPushSubscriptionBlockedAlert"),f=e.querySelector(".js-webPushSubscriptionPreview");Array.from(e.children).forEach(function(c){c.classList.contains("js-bell-widget-icon")?(c.style.display="flex",c.addEventListener("mouseenter",function(){var c=w();f&&"none"!==f.style.display||a&&"none"!==a.style.display||c&&
"denied"===c.permission?f&&"none"!==f.style.display||a&&"none"!==a.style.display||!d||"none"!==d.style.display||!c||"denied"!==c.permission||(d.style.display="block"):b.style.display="block"}),c.addEventListener("mouseleave",function(){var c=w();f&&"none"!==f.style.display||a&&"none"!==a.style.display||c&&"denied"===c.permission?f&&"none"!==f.style.display||a&&"none"!==a.style.display||!d||"none"===d.style.display||!c||"denied"!==c.permission||(d.style.display="none"):b.style.display="none"}),c.addEventListener("click",
function(){var c=w();c&&"denied"===c.permission&&(a.style.display="block",b.style.display="none",d.style.display="none")})):c.style.display="none"})}}catch(g){c.error("prompt widget error:",g)}}}}(),v=function(){function a(){window.addEventListener("message",function(a){try{if(0==a.origin.indexOf(b.main.proxyDomain))if("pong"==a.data)clearInterval(t),d();else if("SYNC"==a.data)u.a({key:"synced",value:(new Date).toString()});else{var e=1E3*b.subscription.timeSuccessShow;if("refused"==a.data)n();else if(0===
a.data.indexOf("SID|")){var f=a.data.split("|");if(2==f.length){var g={};g.token=f[1];R(g)}}else if(0===a.data.indexOf("SDO|"))try{f=a.data.split("|"),2==f.length&&(g=JSON.parse(f[1]),R(g))}catch(h){}setTimeout(function(){try{null!=m&&m.close()}catch(a){c.error("iframe: ",a)}},e)}}catch(h){c.error("iframe: ",h)}},!1)}function d(){try{r.close()}catch(a){c.error("iframe: ",a)}}function f(){var a=window.location.protocol;if("true"===b.subscription.FLOATING_BUTTON_ENABLED||!b.main.proxyDomain&&"https:"===
a)d(),M.j();else try{m=window.open(b.main.proxyDomain+"/subscription/"+b.main.APPLICATION_ID,"_blank","scrollbars=yes, width=500, height=500, top="+(g()/2-250+k())+", left="+(e()/2-250+l())),window.focus&&m.focus(),t=setInterval(function(){try{m.postMessage("ping",b.main.proxyDomain),m.postMessage("callFrom|"+window.location.href,b.main.proxyDomain)}catch(a){d()}},100)}catch(f){c.error("iframe: ",f)}}function e(){return window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:
screen.width}function g(){return window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height}function l(){return void 0!==window.screenLeft?window.screenLeft:screen.left}function k(){return void 0!==window.screenTop?window.screenTop:screen.top}var m=null,n=null,t=null,q=null,u=null;return{I:function(b,d){try{c.log("UI Module Init."),a(),n=d,r.h(f,n),u=b}catch(e){c.error("iframe: ",e)}},f:function(){try{u.a({key:"userPrompted",value:{date:(new Date).toString()}}),
r.show()}catch(a){c.error("iframe: ",a)}},Z:function(){try{var a=v.H(),d=v.G(),e=a/2-b.validation.validationWindowWidth/2+v.C(),f=d/2-b.validation.validationWindowHeight/2+v.D();q=window.open(b.main.proxyDomain+"/resource/update-frame/"+b.main.APPLICATION_ID,"_blank","location=no, scrollbars=no, width="+b.validation.validationWindowWidth+", height="+b.validation.validationWindowHeight+", top="+f+", left="+e);q.blur();window.focus()}catch(g){c.log("Error: "+g)}},P:d,H:e,G:g,C:l,D:k,L:function(){},
M:function(){}}}(),S={g:function(){var a=this.o()||this.u()||this.s();return this.v(a)},o:function(){return document.querySelector("html").getAttribute("lang")},s:function(){return navigator.language},u:function(){var a=location.pathname.split("/")[1];return a&&2===a.length?a:null},v:function(a){return a.split("-")[0].toLowerCase()}};return u})(this,{});
(function(c,b){function e(){for(var a=c[d].q;0<a.length;)h(a)}function h(a){try{if(0!=a.length){var b=a.shift(),c=b[0];a=[];for(var d=1;d<b.length;d++)a.push(b[d]);k(c,a)}}catch(e){}}function k(a,c){for(f in b)if(b.hasOwnProperty(f)){var d=b[f];if(f===a){d.apply(this,c);break}}}var d=c.esSdk;c[d]?(c[d].q||(c[d].q=[]),c[d].q.push=function(){var a=Array.prototype.push.apply(this,arguments);h(c[d].q);return a},e()):console.log("Using SDK synchronously")}(this,this.__es_sdk));
